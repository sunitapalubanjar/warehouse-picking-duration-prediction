---
title: "EDA"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# 1) Load cleaned data
logistics_picking_data <- readRDS("../data/clean_logistics_picking_data.rds")
```


```{r}


summary(logistics_picking_data)

```

# 3.Exploratory Data Analysis (EDA)
This section explores the dataset through visualizations such as histograms, bar plots, box plots, and correlation heatmaps to uncover patterns and insights in the data.

I began the exploratory analysis by examining the distribution of the target variable picking_duration_sec, which measures how long each picking task took. This helps assess the overall range, variability, and presence of potential outliers.

## 3.1 Picking Duration (seconds)
## Target Variable Inspection:

### Picking Duration (seconds)
```{r}

# Summary stats of the target variable
summary(logistics_picking_data$picking_duration_sec)

# Histogram of picking duration

hist(logistics_picking_data$picking_duration_sec,
     breaks = 100,
     main = "Distribution of Picking Duration (seconds)",
     xlab = "Picking Duration (seconds)",
     col = "steelblue",
     border = "white")

```

The majority of picking tasks were completed in under 100 seconds, with a right-skewed distribution and some extreme values up to 2,247 seconds. This indicates variability in task complexity and potential operational delays. The presence of outliers and a skewed distribution suggests that transformation or outlier treatment may be required before modeling

## 3.2 Volume Distribution and Its Relationship to Picking Duration
I explored the role of volume (measured in cubic meters) to understand how order size might influence picking time. First, I visualized its distribution to detect skewness or irregular values. Then, I examined the relationship between volume and task duration using a scatterplot to assess whether larger orders are generally associated with longer picking times.

```{r}
# Histogram: Volume distribution
ggplot(logistics_picking_data, aes(x = volume)) +
  geom_histogram(fill = "darkorange", bins = 50) +
  labs(title = "Distribution of Volume (m³)",
       x = "Volume", y = "Count") +
  theme_minimal()

```


```{r}
# Scatterplot: Volume vs. Picking Duration
plot(logistics_picking_data$volume, logistics_picking_data$picking_duration_sec,
     main = "Volume vs Picking Duration",
     xlab = "Volume (m³)",
     ylab = "Duration (seconds)",
     pch = 19,
     col = rgb(0.2, 0.4, 0.6, 0.4))  # transparent dots

```
The volume variable shows a strong right-skew, with most orders being small in size. The scatterplot reveals a wide spread of picking times for low-volume tasks and a few extreme values for larger orders. While the relationship is not linear, there is an overall pattern suggesting that higher volume may contribute to longer picking times, which supports its inclusion as a predictor in the modeling phase.

## 3.3 Picking Duration by Weekday
To investigate whether task efficiency varies across the week, I examined the distribution of picking durations by weekday. Given that the Salling warehouse operates under tight delivery deadlines, especially during weekend shifts, understanding weekday-based performance differences is important for optimizing staffing and scheduling.

```{r}
#See if some days are consistently slower/faster.


# Ensure weekday is in proper order (Monday to Sunday)
logistics_picking_data$weekday_name <- factor(
  logistics_picking_data$weekday_name,
  levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")
)

# Boxplot with means overlaid
ggplot(logistics_picking_data, aes(x = weekday_name, y = picking_duration_sec)) +
  geom_boxplot(fill = "lightgreen", outlier.shape = 1, outlier.size = 1, width = 0.6) +
  stat_summary(fun = mean, geom = "point", shape = 20, color = "red", size = 2) +
  labs(
    title = "Picking Duration by Weekday",
    x = "Weekday",
    y = "Picking Duration (seconds)"
  ) +
  theme_minimal(base_size = 13) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  )

```

```{r}
# Set weekday order
logistics_picking_data$weekday_name <- factor(
  logistics_picking_data$weekday_name,
  levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")
)

# Boxplot with mean points, zoomed in to 0–200 seconds
ggplot(logistics_picking_data, aes(x = weekday_name, y = picking_duration_sec)) +
  geom_boxplot(fill = "lightgreen", outlier.shape = 1, outlier.size = 1, width = 0.6) +
  stat_summary(fun = mean, geom = "point", shape = 20, color = "red", size = 2) +
  labs(
    title = "Picking Duration by Weekday (Zoomed to 0–500 seconds)",
    x = "Weekday",
    y = "Picking Duration (seconds)"
  ) +
  coord_cartesian(ylim = c(0, 200)) +  # Zoom in
  theme_minimal(base_size = 13) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```

```{r}
# Assuming your dataset is named `logistics_picking_data`
# Summary statistics by weekday
summary_by_weekday <- logistics_picking_data %>%
  group_by(weekday_name) %>%
  summarise(
    mean_duration = mean(picking_duration_sec, na.rm = TRUE),
    median_duration = median(picking_duration_sec, na.rm = TRUE),
    count = n()
  ) %>%
  arrange(factor(weekday_name, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")))

# View result
print(summary_by_weekday)
```

```{r}
# ANOVA test: does picking duration differ by weekday?
anova_weekday <- aov(picking_duration_sec ~ weekday_name, data = logistics_picking_data)
summary(anova_weekday)
```
The full-range boxplot reveals a consistent spread of picking durations across all weekdays, with numerous outliers exceeding 1,000 seconds. However, the zoomed-in version (0–200 seconds) shows more clearly that the median and interquartile range remain fairly stable across days, with only minor variation.

To assess whether these differences are statistically meaningful, I conducted a one-way ANOVA test. The results show a significant effect of weekday on picking duration (F(6, 217862) = 13.8, p < 0.001). While the visual differences in medians are small, the statistical test suggests that factors related to day-of-week—such as staffing levels, order load, or shift dynamics at the Salling warehouse—could be influencing efficiency.

These insights can help guide scheduling improvements, particularly on high-variance days like Tuesday and Sunday, where outlier activity appears slightly elevated.

## 3.4 Picker Efficiency Comparison
To assess variation in individual picker performance, I visualized the distribution of picking durations for the top 10 most active pickers in the dataset. This analysis helps identify whether certain workers consistently perform faster or slower than others. I also conducted an ANOVA test to determine if these differences are statistically significant.

```{r}
# Count number of tasks per picker
picker_counts <- logistics_picking_data %>%
  count(picker, sort = TRUE)

# View top pickers
head(picker_counts, 10)
```

```{r}
# Identify top 10 pickers by frequency
top_pickers <- logistics_picking_data %>%
  count(picker, sort = TRUE) %>%
  top_n(10) %>%
  pull(picker)


# Boxplot of picking durations for top 10 pickers
logistics_picking_data %>%
  filter(picker %in% top_pickers) %>%
  ggplot(aes(x = picker, y = picking_duration_sec)) +
  geom_boxplot(fill = "lightgreen") +
  labs(title = "Picking Duration for Top 10 Pickers", x = "Picker", y = "Duration (sec)") +
  theme_minimal()
```

```{r}
# ANOVA: Does picking duration differ by picker?
anova_result <- aov(picking_duration_sec ~ picker, data = logistics_picking_data)
summary(anova_result)

```
The boxplot reveals noticeable variation in task duration across the top 10 pickers, suggesting that individual performance differs even within the same operational environment. While some pickers show tighter and lower duration ranges, others have wider spreads and more outliers.

The ANOVA test confirms these differences are statistically significant (F(36, 217832) = 7.73, p < 0.001). This highlights potential opportunities for training, best-practice sharing, or scheduling adjustments to improve overall efficiency within the warehouse.



## 3.5 Picking Duration by Product ID
To explore whether product type impacts task duration, I analyzed picking time distributions across the 10 most frequently picked product IDs. Certain products may require more handling time due to size, location, or packaging constraints, which can affect operational efficiency in the warehouse.

### Picking duration by product id
```{r}
# Identify top 10 most frequently picked products
top_products <- logistics_picking_data %>%
  count(product_id, sort = TRUE) %>%
  top_n(10) %>%
  pull(product_id)

# Boxplot of picking duration for top products
logistics_picking_data %>%
  filter(product_id %in% top_products) %>%
  ggplot(aes(x = product_id, y = picking_duration_sec)) +
  geom_boxplot(fill = "lightblue") +
  labs(
    title = "Picking Duration by Top 10 Product IDs",
    x = "Product ID",
    y = "Duration (sec)"
  ) +
  theme_minimal()

```

The boxplots by product_id show that certain products are associated with longer picking durations, potentially due to factors like size, fragility, or location within the warehouse. However, while this adds useful context during exploratory analysis, the differences are relatively minor. Moreover, the anonymized nature of the product_id variable limits interpretability and operational relevance. These factors support the decision to exclude product_id from the final predictive model, as it does not provide clear, actionable insight for improving warehouse efficiency.

## 3.6 Picking Duration by Colli ID
I investigated whether specific colli_ids (order units) are consistently associated with longer picking times. Since each colli represents a unique package, this analysis helps identify whether some orders are disproportionately time-consuming and whether this feature is suitable for modeling.

```{r}
n_distinct(logistics_picking_data$collli_id)

# Top 10 colli_ids with highest average picking duration
logistics_picking_data %>%
  group_by(collli_id) %>%
  summarise(mean_duration = mean(picking_duration_sec, na.rm = TRUE)) %>%
  arrange(desc(mean_duration)) %>%
  head(10)
```

The impact of colli_id is even more dramatic, with some IDs associated with durations exceeding 800 seconds. This likely reflects multi-product or complex orders. However, colli_id has over 8,000 unique values, making it a high-cardinality feature with little generalization potential. While it influences duration, its inclusion in modeling is not practical without dimensionality reduction or aggregation. Given its one-time, anonymized nature, I chose to exclude it from the final model.
 
## 3.7 Correlation Analysis of Numeric Features
To understand the linear relationships between numeric variables, computed and visualized a correlation matrix. This helps identify redundant predictors and gives a preliminary view of which features might be associated with picking duration.

```{r}
# Select numeric columns and compute correlation matrix
cor_matrix <- logistics_picking_data %>%
  select(picking_duration_sec, volume, wm_vsola, location_row, location_id) %>%
  cor(use = "complete.obs")

# Plot correlation matrix
ggcorrplot(cor_matrix, 
           method = "square", 
           type = "lower", 
           lab = TRUE, 
           title = "Correlation Matrix of Numeric Features")
```

The matrix shows weak positive correlations between picking duration and order size (volume, wm_vsola), suggesting larger items may slightly increase task time. Location variables have low or negative correlations, hinting at possible layout effects. The strong correlation between volume and wm_vsola suggests redundancy. Overall, these low correlations indicate that simple linear models may not fully capture picking behavior at the warehouse

## 3.8 Location-Based Patterns in Picking Duration
```{r}
# Heatmap: average picking duration by warehouse zone
logistics_picking_data %>%
  group_by(location_row, location_id) %>%
  summarise(avg_duration = mean(picking_duration_sec, na.rm = TRUE), .groups = "drop") %>%
  ggplot(aes(x = location_row, y = location_id, fill = avg_duration)) +
  geom_tile(color = "white") +
  scale_fill_viridis_c() +
  labs(title = "Average Picking Duration by Warehouse Location",
       x = "Row", y = "Location ID") +
  theme_minimal()

```


```{r}
# ANOVA: effect of row and ID on picking duration
anova_location <- aov(picking_duration_sec ~ location_row, data = logistics_picking_data)
anova_location_id <- aov(picking_duration_sec ~ location_id, data = logistics_picking_data)
summary(anova_location)
summary(anova_location_id)
```

The heatmap shows clear variation in average picking duration across warehouse zones. location_row displays a consistent trend and was kept as numeric. In contrast, location_id shows irregular patterns and was treated as a categorical factor. ANOVA tests confirmed that both variables significantly influence picking time, supporting their inclusion in the model to capture layout-related effects.


## 3.9 Distribution of Picking Tasks by Hour
```{r}
# Extract hour from start_time
logistics_picking_data <- logistics_picking_data %>%
  mutate(pick_hour = hour(start_time))

# Bar plot of picking task counts by hour
ggplot(logistics_picking_data, aes(x = factor(pick_hour))) +
  geom_bar(fill = "skyblue") +
  labs(
    title = "Number of Picking Tasks by Hour",
    x = "Hour of Day (0–23)",
    y = "Count of Picks"
  ) +
  theme_minimal()
```

Most picking tasks occur between midnight and 3 AM, and again between 8 PM and midnight, reflecting Salling’s overnight and late-evening shift patterns. These patterns help explain time-based variation in performance and justify including pick hour as a feature in the model.